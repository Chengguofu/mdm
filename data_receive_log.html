<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>‰∏ªÊï∞ÊçÆÊé•Êî∂Êó•Âøó</title>
    <style>
        body { margin: 0; font-family: 'Microsoft YaHei', Arial, sans-serif; background: #f7faff; font-size: 14px; }
        .layout { display: flex; height: 100vh; }
        .sidebar { width: 196px; background: #fff; border-right: 1px solid #e3eaf3; display: flex; flex-direction: column; }
        .sidebar-header { padding: 20px; border-bottom: 1px solid #e3eaf3; background: #f4f8fb; }
        .sidebar-title { font-size: 17px; color: #2176c7; font-weight: 600; margin-bottom: 15px; }
        .search-box { position: relative; padding: 0 12px 12px 12px; }
        .search-input { width: 100%; box-sizing: border-box; padding: 8px 12px 8px 36px; border: 1.2px solid #c0d3eb; border-radius: 4px; font-size: 15px; background: #f9fbfd; }
        .search-icon { position: absolute; left: 18px; top: 50%; transform: translateY(-50%); width: 16px; height: 16px; pointer-events: none; }
        .search-icon::before { content: ''; display: block; width: 12px; height: 12px; border: 2px solid #b0c4d8; border-radius: 50%; position: absolute; left: 0; top: 0; background: none; }
        .search-icon::after { content: ''; display: block; width: 7px; height: 2px; background: #b0c4d8; position: absolute; left: 9px; top: 10px; border-radius: 2px; transform: rotate(45deg); }
        .data-type-list { flex: 1; overflow-y: auto; }
        .data-type-item { cursor: pointer; padding: 12px 20px; border-bottom: 1px solid #e3eaf3; transition: background-color 0.2s; display: flex; align-items: center; justify-content: space-between; }
        .data-type-item:hover { background-color: #f0f6fd; }
        .data-type-item.active { background-color: #2176c7; color: white; }
        .data-type-item.active .data-type-count { background-color: rgba(255,255,255,0.2); color: white; }
        .data-type-info { display: flex; align-items: center; gap: 8px; }
        .data-type-icon { font-size: 15px; }
        .data-type-count { background: #e3eaf3; color: #2176c7; padding: 2px 8px; border-radius: 12px; font-size: 11px; font-weight: 500; }
        .main-content { flex: 1; display: flex; flex-direction: column; background: #f4f8fb; }
        .tabs-bar { display: flex; background: #fff; border-bottom: 1.5px solid #e3eaf3; }
        .tab { padding: 16px 36px; cursor: pointer; font-size: 15px; font-weight: 600; color: #185a99; border-bottom: 2.5px solid transparent; transition: all 0.2s; }
        .tab.active { color: #2176c7; border-bottom-color: #2176c7; background: #f8fbff; }
        .query-section { background: #f8fbff; border: 1px solid #e3eaf3; border-radius: 8px; padding: 18px 24px; margin: 24px 24px 0 24px; display: flex; flex-wrap: wrap; gap: 18px 32px; align-items: flex-end; }
        .query-item { display: flex; flex-direction: column; gap: 6px; min-width: 180px; }
        .query-label { font-size: 13px; color: #666; font-weight: 500; }
        .query-input, .query-select { padding: 7px 12px; border: 1px solid #e3eaf3; border-radius: 4px; font-size: 13px; background: #fff; }
        .query-input:focus, .query-select:focus { border-color: #2176c7; }
        .query-btns { display: flex; gap: 10px; }
        .btn-main { background: #2176c7; color: #fff; border: none; border-radius: 4px; padding: 7px 22px; font-size: 14px; font-weight: 500; cursor: pointer; transition: background 0.18s; }
        .btn-main:hover { background: #185a99; }
        .btn-main:disabled { background: #ccc; cursor: not-allowed; }
        .btn-line { background: #fff; color: #2176c7; border: none; border-radius: 4px; padding: 7px 18px; font-size: 14px; font-weight: 500; cursor: pointer; transition: background 0.18s; }
        .btn-line:hover { background: #f5f7fa; color: #185a99; }
        .btn-line:disabled { background: #f5f5f5; color: #ccc; cursor: not-allowed; }
        .btn-archive { background: #fff; color: #f57c00; border: none; border-radius: 4px; padding: 7px 18px; font-size: 14px; font-weight: 500; cursor: pointer; transition: background 0.18s; }
        .btn-archive:hover { background: #fff3e0; color: #e65100; }
        .btn-archive:disabled { background: #f5f5f5; color: #ccc; cursor: not-allowed; }
        .btn-delete:disabled { background: #f5f5f5; color: #ccc; cursor: not-allowed; }
        .dropdown { position: relative; display: inline-block; }
        .dropdown-content { display: none; position: absolute; right: 0; background-color: #fff; min-width: 140px; box-shadow: 0 8px 16px rgba(0,0,0,0.15); border-radius: 4px; z-index: 1000; border: 1px solid #e3eaf3; }
        .dropdown-content.show { display: block; }
        .dropdown-item { color: #333; padding: 10px 16px; text-decoration: none; display: block; cursor: pointer; font-size: 13px; transition: background-color 0.2s; }
        .dropdown-item:hover { background-color: #f0f6fd; }
        .dropdown-item.delete-selected { color: #e74c3c; }
        .dropdown-item.delete-all { color: #e74c3c; }
        .dropdown-item.delete-selected:hover, .dropdown-item.delete-all:hover { background-color: #ffebee; }
        .dropdown-toggle { background: #fff; color: #e74c3c; border: none; border-radius: 4px; padding: 7px 18px; font-size: 14px; font-weight: 500; cursor: pointer; transition: background 0.18s; display: flex; align-items: center; gap: 6px; }
        .dropdown-toggle:hover { background: #ffebee; color: #c62828; }
        .dropdown-toggle:disabled { background: #f5f5f5; color: #ccc; cursor: not-allowed; }
        .dropdown-arrow { width: 0; height: 0; border-left: 4px solid transparent; border-right: 4px solid transparent; border-top: 4px solid currentColor; }
        .dropdown-toggle.retry { background: #2176c7; color: #fff; }
        .dropdown-toggle.retry:hover { background: #185a99; }
        .dropdown-toggle.retry:disabled { background: #ccc; color: #fff; }
        .dropdown-item.retry-selected { color: #2176c7; }
        .dropdown-item.retry-all { color: #2176c7; }
        .dropdown-item.retry-selected:hover, .dropdown-item.retry-all:hover { background-color: #f0f6fd; }
        .table-wrap { background: #fff; border-radius: 8px; box-shadow: 0 2px 8px rgba(33, 118, 199, 0.06); margin: 24px; overflow: hidden; }
        table { width: 100%; border-collapse: separate; border-spacing: 0; font-size: 14px; background: #fff; }
        th, td { padding: 12px 16px; border-bottom: 1px solid #e3eaf3; text-align: left; }
        th { background: #f4f8fb; color: #2176c7; font-weight: 600; }
        tr:last-child td { border-bottom: none; }
        tr:hover td { background: #f0f6fd; }
        .checkbox { width: 16px; height: 16px; cursor: pointer; }
        .status-badge { padding: 4px 10px; border-radius: 12px; font-size: 12px; font-weight: 500; }
        .status-success { background: #e8f5e8; color: #2e7d32; }
        .status-fail { background: #ffeaea; color: #e74c3c; }
        .status-running { background: #fffbe6; color: #f57c00; }
        .serial-link { color: #2176c7; cursor: pointer; text-decoration: underline; font-weight: 600; }
        .btn-view-message { background: #fff; color: #2176c7; border: none; border-radius: 4px; padding: 4px 12px; font-size: 12px; cursor: pointer; transition: all 0.2s; }
        .btn-view-message:hover { background: #f0f6fd; color: #185a99; }
        .toolbar { display: flex; gap: 12px; align-items: center; margin: 0 24px 0 24px; padding: 16px 0 0 0; }
        /* ÊäΩÂ±âÊ†∑Âºè */
        .drawer-mask { position: fixed; right: 0; top: 0; bottom: 0; left: 0; background: rgba(0,0,0,0.18); z-index: 9999; display: none; }
        .drawer { position: fixed; right: 0; top: 0; bottom: 0; width: 600px; max-width: 98vw; background: #fff; box-shadow: -2px 0 16px rgba(33,118,199,0.13); z-index: 10000; display: flex; flex-direction: column; }
        .drawer-header { padding: 20px 28px 12px 28px; font-size: 17px; font-weight: 600; color: #2176c7; border-bottom: 1px solid #e3eaf3; display: flex; justify-content: space-between; align-items: center; }
        .drawer-close { font-size: 22px; color: #888; cursor: pointer; border: none; background: none; transition: .2s; }
        .drawer-close:hover { color: #d33; }
        .drawer-body { flex: 1; overflow-y: auto; padding: 24px; }
        .drawer-title { font-size: 16px; color: #2176c7; font-weight: 600; margin-bottom: 18px; }
        .drawer-section { margin-bottom: 18px; }
        .drawer-section-title { font-size: 14px; color: #185a99; font-weight: 600; margin-bottom: 8px; }
        .code-block { background: #f8f9fa; border: 1px solid #e3eaf3; border-radius: 4px; padding: 16px; font-family: 'Courier New', monospace; font-size: 13px; line-height: 1.5; white-space: pre; overflow-x: auto; }
    </style>
</head>
<body>
<div class="layout">
    <div class="sidebar">
        <div class="sidebar-header">
            <div class="sidebar-title">‰∏ªÊï∞ÊçÆÁ±ªÂûã</div>
            <div class="search-box">
                <span class="search-icon"></span>
                <input type="text" class="search-input" id="dataTypeSearch" placeholder="ÊêúÁ¥¢‰∏ªÊï∞ÊçÆÁ±ªÂûã...">
            </div>
        </div>
        <div class="data-type-list" id="dataTypeList">
            <div class="data-type-item active" data-type="ÂÆ¢Êà∑‰∏ªÊï∞ÊçÆ"><div class="data-type-info"><span class="data-type-icon">üë•</span><span>ÂÆ¢Êà∑‰∏ªÊï∞ÊçÆ</span></div></div>
            <div class="data-type-item" data-type="‰∫ßÂìÅ‰∏ªÊï∞ÊçÆ"><div class="data-type-info"><span class="data-type-icon">üì¶</span><span>‰∫ßÂìÅ‰∏ªÊï∞ÊçÆ</span></div></div>
            <div class="data-type-item" data-type="‰æõÂ∫îÂïÜ‰∏ªÊï∞ÊçÆ"><div class="data-type-info"><span class="data-type-icon">üöö</span><span>‰æõÂ∫îÂïÜ‰∏ªÊï∞ÊçÆ</span></div></div>
            <div class="data-type-item" data-type="ÂëòÂ∑•‰∏ªÊï∞ÊçÆ"><div class="data-type-info"><span class="data-type-icon">üë§</span><span>ÂëòÂ∑•‰∏ªÊï∞ÊçÆ</span></div></div>
            <div class="data-type-item" data-type="ÁªÑÁªá‰∏ªÊï∞ÊçÆ"><div class="data-type-info"><span class="data-type-icon">üè¢</span><span>ÁªÑÁªá‰∏ªÊï∞ÊçÆ</span></div></div>
            <div class="data-type-item" data-type="Âú∞ÁÇπ‰∏ªÊï∞ÊçÆ"><div class="data-type-info"><span class="data-type-icon">üìç</span><span>Âú∞ÁÇπ‰∏ªÊï∞ÊçÆ</span></div></div>
        </div>
    </div>
    <div class="main-content">
        <div class="tabs-bar">
            <div class="tab active" id="tabSync" onclick="switchTab('sync')">ÂêåÊ≠•Êó•Âøó</div>
            <div class="tab" id="tabFail" onclick="switchTab('fail')">ÂêåÊ≠•Â§±Ë¥•Êó•Âøó</div>
        </div>
        <div id="querySection" class="query-section"></div>
        <div id="toolbar" class="toolbar" style="display:none;"></div>
        <div class="table-wrap">
            <table>
                <thead>
                    <tr><th id="selectAllHeader" style="display:none;"><input type="checkbox" class="checkbox" id="selectAll" onclick="toggleSelectAll()"></th><th>Â∫èÂè∑</th><th>ÁºñÁ†Å</th><th>ÂêçÁß∞</th><th>‰∏öÂä°Á≥ªÁªü</th><th>ÂêåÊ≠•ÁªìÊûú</th><th>ÂêåÊ≠•‰ø°ÊÅØ</th><th>ÂêåÊ≠•Êó∂Èó¥</th><th>Êìç‰Ωú‰∫∫</th><th>Êìç‰Ωú</th></tr>
                </thead>
                <tbody id="logTableBody"></tbody>
            </table>
        </div>
    </div>
</div>
<!-- Âè≥‰æßÊäΩÂ±â -->
<div class="drawer-mask" id="drawerMask">
    <div class="drawer">
        <div class="drawer-header">
            <span>Êó•ÂøóËØ¶ÊÉÖ</span>
            <button class="drawer-close" onclick="closeDrawer()">√ó</button>
        </div>
        <div class="drawer-body">
            <div class="drawer-title" id="drawerTitle">Êó•ÂøóËØ¶ÊÉÖ</div>
            <div class="drawer-section">
                <div class="drawer-section-title">ËØ∑Ê±ÇÊä•Êñá</div>
                <div class="code-block" id="drawerRequest"></div>
            </div>
            <div class="drawer-section">
                <div class="drawer-section-title">ÂìçÂ∫îÊä•Êñá</div>
                <div class="code-block" id="drawerResponse"></div>
            </div>
        </div>
    </div>
</div>
<script>
// Ê®°ÊãüÊï∞ÊçÆ
const allSyncLogs = {
    'ÂÆ¢Êà∑‰∏ªÊï∞ÊçÆ': [
        { id: 1, code: 'API_001', name: 'ÂÆ¢Êà∑‰∏ªÊï∞ÊçÆÊé•Êî∂Êé•Âè£', system: 'CRMÁ≥ªÁªü', result: 'ÊàêÂäü', info: 'ÂêåÊ≠•ÂÆåÊàê', time: '2024-06-01 10:00', user: 'Âº†‰∏â', req: { dataType: 'ÂÆ¢Êà∑‰∏ªÊï∞ÊçÆ', op: 'CREATE' }, resp: { code: 200, msg: 'ok' } },
        { id: 2, code: 'API_002', name: 'ÂÆ¢Êà∑‰∏ªÊï∞ÊçÆÊé•Êî∂Êé•Âè£', system: 'ERPÁ≥ªÁªü', result: 'Â§±Ë¥•', info: 'Êï∞ÊçÆÊ†ºÂºèÈîôËØØ', time: '2024-06-01 09:30', user: 'ÊùéÂõõ', req: { dataType: 'ÂÆ¢Êà∑‰∏ªÊï∞ÊçÆ', op: 'UPDATE' }, resp: { code: 500, msg: 'error' } }
    ],
    '‰∫ßÂìÅ‰∏ªÊï∞ÊçÆ': [
        { id: 3, code: 'API_003', name: '‰∫ßÂìÅ‰∏ªÊï∞ÊçÆÊé•Êî∂Êé•Âè£', system: 'ERPÁ≥ªÁªü', result: 'ËøõË°å‰∏≠', info: 'Ê≠£Âú®Â§ÑÁêÜ', time: '2024-05-31 17:20', user: 'Áéã‰∫î', req: { dataType: '‰∫ßÂìÅ‰∏ªÊï∞ÊçÆ', op: 'CREATE' }, resp: { code: 0, msg: '' } }
    ],
    '‰æõÂ∫îÂïÜ‰∏ªÊï∞ÊçÆ': [
        { id: 4, code: 'API_004', name: '‰æõÂ∫îÂïÜ‰∏ªÊï∞ÊçÆÊé•Êî∂Êé•Âè£', system: 'SRMÁ≥ªÁªü', result: 'ÊàêÂäü', info: 'ÂêåÊ≠•ÂÆåÊàê', time: '2024-05-31 16:45', user: 'ËµµÂÖ≠', req: { dataType: '‰æõÂ∫îÂïÜ‰∏ªÊï∞ÊçÆ', op: 'CREATE' }, resp: { code: 200, msg: 'ok' } }
    ],
    'ÂëòÂ∑•‰∏ªÊï∞ÊçÆ': [
        { id: 5, code: 'API_005', name: 'ÂëòÂ∑•‰∏ªÊï∞ÊçÆÊé•Êî∂Êé•Âè£', system: 'HRÁ≥ªÁªü', result: 'ÊàêÂäü', info: 'ÂêåÊ≠•ÂÆåÊàê', time: '2024-05-31 15:30', user: 'Èí±‰∏É', req: { dataType: 'ÂëòÂ∑•‰∏ªÊï∞ÊçÆ', op: 'UPDATE' }, resp: { code: 200, msg: 'ok' } }
    ],
    'ÁªÑÁªá‰∏ªÊï∞ÊçÆ': [
        { id: 6, code: 'API_006', name: 'ÁªÑÁªá‰∏ªÊï∞ÊçÆÊé•Êî∂Êé•Âè£', system: 'OAÁ≥ªÁªü', result: 'Â§±Ë¥•', info: 'ÁΩëÁªúËøûÊé•Ë∂ÖÊó∂', time: '2024-05-31 14:20', user: 'Â≠ôÂÖ´', req: { dataType: 'ÁªÑÁªá‰∏ªÊï∞ÊçÆ', op: 'CREATE' }, resp: { code: 408, msg: 'timeout' } }
    ],
    'Âú∞ÁÇπ‰∏ªÊï∞ÊçÆ': []
};
const allFailLogs = {
    'ÂÆ¢Êà∑‰∏ªÊï∞ÊçÆ': [
        { id: 2, code: 'API_002', name: 'ÂÆ¢Êà∑‰∏ªÊï∞ÊçÆÊé•Êî∂Êé•Âè£', system: 'ERPÁ≥ªÁªü', result: 'Â§±Ë¥•', info: 'Êï∞ÊçÆÊ†ºÂºèÈîôËØØ', time: '2024-06-01 09:30', user: 'ÊùéÂõõ', req: { dataType: 'ÂÆ¢Êà∑‰∏ªÊï∞ÊçÆ', op: 'UPDATE' }, resp: { code: 500, msg: 'error' } }
    ],
    '‰∫ßÂìÅ‰∏ªÊï∞ÊçÆ': [],
    '‰æõÂ∫îÂïÜ‰∏ªÊï∞ÊçÆ': [],
    'ÂëòÂ∑•‰∏ªÊï∞ÊçÆ': [],
    'ÁªÑÁªá‰∏ªÊï∞ÊçÆ': [
        { id: 6, code: 'API_006', name: 'ÁªÑÁªá‰∏ªÊï∞ÊçÆÊé•Êî∂Êé•Âè£', system: 'OAÁ≥ªÁªü', result: 'Â§±Ë¥•', info: 'ÁΩëÁªúËøûÊé•Ë∂ÖÊó∂', time: '2024-05-31 14:20', user: 'Â≠ôÂÖ´', req: { dataType: 'ÁªÑÁªá‰∏ªÊï∞ÊçÆ', op: 'CREATE' }, resp: { code: 408, msg: 'timeout' } }
    ],
    'Âú∞ÁÇπ‰∏ªÊï∞ÊçÆ': []
};
const statusClass = { 'ÊàêÂäü': 'status-success', 'Â§±Ë¥•': 'status-fail', 'ËøõË°å‰∏≠': 'status-running' };
let currentTab = 'sync';
let currentType = 'ÂÆ¢Êà∑‰∏ªÊï∞ÊçÆ';
let query = { code: '', system: '', result: '', info: '', time: '', user: '' };
let selectedIds = [];

function renderQuerySection() {
    document.getElementById('querySection').innerHTML = `
        <div class="query-item">
            <label class="query-label">ÁºñÁ†Å</label>
            <input class="query-input" id="qCode" placeholder="ËØ∑ËæìÂÖ•ÁºñÁ†Å" value="${query.code||''}">
        </div>
        <div class="query-item">
            <label class="query-label">‰∏öÂä°Á≥ªÁªü</label>
            <select class="query-select" id="qSystem">
                <option value="">ÂÖ®ÈÉ®</option>
                <option value="CRMÁ≥ªÁªü">CRMÁ≥ªÁªü</option>
                <option value="ERPÁ≥ªÁªü">ERPÁ≥ªÁªü</option>
                <option value="SRMÁ≥ªÁªü">SRMÁ≥ªÁªü</option>
                <option value="HRÁ≥ªÁªü">HRÁ≥ªÁªü</option>
                <option value="OAÁ≥ªÁªü">OAÁ≥ªÁªü</option>
            </select>
        </div>
        <div class="query-item">
            <label class="query-label">ÂêåÊ≠•Áä∂ÊÄÅ</label>
            <select class="query-select" id="qResult">
                <option value="">ÂÖ®ÈÉ®</option>
                <option value="ÊàêÂäü">ÊàêÂäü</option>
                <option value="Â§±Ë¥•">Â§±Ë¥•</option>
                <option value="ËøõË°å‰∏≠">ËøõË°å‰∏≠</option>
            </select>
        </div>
        <div class="query-item">
            <label class="query-label">ÂêåÊ≠•‰ø°ÊÅØ</label>
            <input class="query-input" id="qInfo" placeholder="ËØ∑ËæìÂÖ•ÂêåÊ≠•‰ø°ÊÅØ" value="${query.info||''}">
        </div>
        <div class="query-item">
            <label class="query-label">ÂêåÊ≠•Êó∂Èó¥</label>
            <input class="query-input" id="qTime" placeholder="2024-06-01" value="${query.time||''}">
        </div>
        <div class="query-item">
            <label class="query-label">Êìç‰Ωú‰∫∫</label>
            <input class="query-input" id="qUser" placeholder="ËØ∑ËæìÂÖ•Êìç‰Ωú‰∫∫" value="${query.user||''}">
        </div>
        <div class="query-btns">
            <button class="btn-main" onclick="doQuery()">Êü•ËØ¢</button>
            <button class="btn-line" onclick="resetQuery()">ÈáçÁΩÆ</button>
        </div>
    `;
    document.getElementById('qResult').value = query.result;
    document.getElementById('qSystem').value = query.system;
}

function filterLogs(logs) {
    return logs.filter(l =>
        (!query.code || l.code.includes(query.code)) &&
        (!query.system || l.system === query.system) &&
        (!query.result || l.result === query.result) &&
        (!query.info || l.info.includes(query.info)) &&
        (!query.time || l.time.includes(query.time)) &&
        (!query.user || l.user.includes(query.user))
    );
}

function renderTable() {
    const logs = currentTab === 'sync' ? filterLogs(allSyncLogs[currentType]||[]) : filterLogs(allFailLogs[currentType]||[]);
    const tbody = document.getElementById('logTableBody');
    const selectAllHeader = document.getElementById('selectAllHeader');
    
    // ÊòæÁ§∫/ÈöêËóèÂÖ®ÈÄâÂàó
    selectAllHeader.style.display = currentTab === 'fail' ? 'table-cell' : 'none';
    
    tbody.innerHTML = logs.length ? logs.map((l, i) => {
        const checkboxCell = currentTab === 'fail' ? `<td><input type="checkbox" class="checkbox" value="${l.id}" onchange="toggleSelect(${l.id})" ${selectedIds.includes(l.id) ? 'checked' : ''}></td>` : '';
        return `
            <tr>
                ${checkboxCell}
                <td><span class="serial-link" onclick="openDrawer(${l.id})">${i+1}</span></td>
                <td>${l.code}</td>
                <td>${l.name}</td>
                <td>${l.system}</td>
                <td><span class="status-badge ${statusClass[l.result]||''}">${l.result}</span></td>
                <td>${l.info}</td>
                <td>${l.time}</td>
                <td>${l.user}</td>
                <td>
                    <button class="btn-view-message" onclick="viewMessage(${l.id})">Êü•ÁúãÊä•Êñá</button>
                </td>
            </tr>
        `;
    }).join('') : '<tr><td colspan="10" style="text-align:center;color:#aaa;">ÊöÇÊó†Êó•Âøó</td></tr>';
    
    updateToolbarButtons();
}

function toggleSelect(id) {
    const index = selectedIds.indexOf(id);
    if (index > -1) {
        selectedIds.splice(index, 1);
    } else {
        selectedIds.push(id);
    }
    updateSelectAllState();
    updateToolbarButtons();
}

function toggleSelectAll() {
    const selectAll = document.getElementById('selectAll');
    const checkboxes = document.querySelectorAll('#logTableBody input[type="checkbox"]');
    
    if (selectAll.checked) {
        selectedIds = Array.from(checkboxes).map(cb => parseInt(cb.value));
        checkboxes.forEach(cb => cb.checked = true);
    } else {
        selectedIds = [];
        checkboxes.forEach(cb => cb.checked = false);
    }
    updateToolbarButtons();
}

function updateSelectAllState() {
    const selectAll = document.getElementById('selectAll');
    const checkboxes = document.querySelectorAll('#logTableBody input[type="checkbox"]');
    const checkedCount = selectedIds.length;
    
    if (checkedCount === 0) {
        selectAll.checked = false;
        selectAll.indeterminate = false;
    } else if (checkedCount === checkboxes.length) {
        selectAll.checked = true;
        selectAll.indeterminate = false;
    } else {
        selectAll.checked = false;
        selectAll.indeterminate = true;
    }
}

function updateToolbarButtons() {
    const retryBtn = document.getElementById('retryBtn');
    const archiveBtn = document.getElementById('archiveBtn');
    const deleteBtn = document.getElementById('deleteBtn');
    
    if (retryBtn) {
        // ÈáçÊñ∞Êé•Êî∂ÊåâÈíÆÂú®ÊúâÂ§±Ë¥•Êó•ÂøóÊó∂ÂêØÁî®ÔºàÊîØÊåÅÂÖ®ÈÉ®ÈáçÊñ∞Êé•Êî∂Ôºâ
        const failLogs = filterLogs(allFailLogs[currentType]||[]);
        retryBtn.disabled = failLogs.length === 0;
    }
    if (archiveBtn) {
        archiveBtn.disabled = selectedIds.length === 0;
    }
    if (deleteBtn) {
        // Âà†Èô§ÊåâÈíÆÂú®ÊúâÂ§±Ë¥•Êó•ÂøóÊó∂ÂêØÁî®ÔºàÊîØÊåÅÂà†Èô§ÂÖ®ÈÉ®Ôºâ
        const failLogs = filterLogs(allFailLogs[currentType]||[]);
        deleteBtn.disabled = failLogs.length === 0;
    }
}

function switchTab(tab) {
    currentTab = tab;
    selectedIds = []; // ÂàáÊç¢È°µÁ≠æÊó∂Ê∏ÖÁ©∫ÈÄâÊã©
    document.getElementById('tabSync').classList.toggle('active', tab==='sync');
    document.getElementById('tabFail').classList.toggle('active', tab==='fail');
    document.getElementById('toolbar').style.display = tab==='fail' ? 'flex' : 'none';
    renderQuerySection();
    renderTable();
}

function doQuery() {
    query.code = document.getElementById('qCode').value.trim();
    query.system = document.getElementById('qSystem').value;
    query.result = document.getElementById('qResult').value;
    query.info = document.getElementById('qInfo').value.trim();
    query.time = document.getElementById('qTime').value.trim();
    query.user = document.getElementById('qUser').value.trim();
    renderTable();
}
function resetQuery() {
    query = { code: '', system: '', result: '', info: '', time: '', user: '' };
    renderQuerySection();
    renderTable();
}
function openDrawer(id) {
    const logs = currentTab === 'sync' ? allSyncLogs[currentType] : allFailLogs[currentType];
    const log = logs.find(l => l.id === id);
    if (!log) return;
    document.getElementById('drawerTitle').textContent = `Êó•ÂøóËØ¶ÊÉÖ - ${log.code}`;
    document.getElementById('drawerRequest').textContent = JSON.stringify({ ...log.req, example: '...Êä•ÊñáÂÜÖÂÆπ...' }, null, 2);
    document.getElementById('drawerResponse').textContent = JSON.stringify({ ...log.resp, example: '...ËøîÂõûÂÜÖÂÆπ...' }, null, 2);
    document.getElementById('drawerMask').style.display = 'block';
}
function closeDrawer() {
    document.getElementById('drawerMask').style.display = 'none';
}
// Â∑•ÂÖ∑Ê†èÊåâÈíÆ
function renderToolbar() {
    const toolbar = document.getElementById('toolbar');
    toolbar.innerHTML = `
        <div class="dropdown">
            <button class="dropdown-toggle retry" id="retryBtn" onclick="toggleRetryDropdown()" disabled>
                ÈáçÊñ∞Êé•Êî∂
                <span class="dropdown-arrow"></span>
            </button>
            <div class="dropdown-content" id="retryDropdown">
                <div class="dropdown-item retry-selected" onclick="retrySelected()">ÈáçÊñ∞Êé•Êî∂</div>
                <div class="dropdown-item retry-all" onclick="retryAll()">ÂÖ®ÈÉ®ÈáçÊî∂</div>
            </div>
        </div>
        <button class="btn-archive" id="archiveBtn" onclick="archiveSelected()" disabled>ÂΩíÊ°£</button>
        <div class="dropdown">
            <button class="dropdown-toggle" id="deleteBtn" onclick="toggleDeleteDropdown()" disabled>
                Âà†Èô§
                <span class="dropdown-arrow"></span>
            </button>
            <div class="dropdown-content" id="deleteDropdown">
                <div class="dropdown-item delete-selected" onclick="deleteSelected()">Âà†Èô§ÊâÄÈÄâÊó•Âøó</div>
                <div class="dropdown-item delete-all" onclick="deleteAll()">Âà†Èô§ÂÖ®ÈÉ®Êó•Âøó</div>
            </div>
        </div>
    `;
}
function toggleRetryDropdown() {
    const dropdown = document.getElementById('retryDropdown');
    dropdown.classList.toggle('show');
}

function retrySelected() { 
    if (selectedIds.length > 0) {
        alert(`Â∑≤ÈáçÊñ∞Êé•Êî∂ÈÄâ‰∏≠ÁöÑ ${selectedIds.length} Êù°Â§±Ë¥•Êó•ÂøóÔºàÊºîÁ§∫Ôºâ`);
    }
    closeRetryDropdown();
}
function retryAll() { 
    const failLogs = filterLogs(allFailLogs[currentType]||[]);
    if (failLogs.length > 0) {
        alert(`Â∑≤ÂÖ®ÈÉ®ÈáçÊñ∞Êé•Êî∂ ${failLogs.length} Êù°Â§±Ë¥•Êó•ÂøóÔºàÊºîÁ§∫Ôºâ`);
    }
    closeRetryDropdown();
}

function closeRetryDropdown() {
    const dropdown = document.getElementById('retryDropdown');
    dropdown.classList.remove('show');
}

function archiveSelected() {
    if (selectedIds.length > 0) {
        if (confirm(`Á°ÆÂÆöË¶ÅÂΩíÊ°£ÈÄâ‰∏≠ÁöÑ ${selectedIds.length} Êù°Â§±Ë¥•Êó•ÂøóÂêóÔºüÂΩíÊ°£ÂêéÂ∞ÜÊó†Ê≥ïÊÅ¢Â§ç„ÄÇ`)) {
            alert(`Â∑≤ÂΩíÊ°£ÈÄâ‰∏≠ÁöÑ ${selectedIds.length} Êù°Â§±Ë¥•Êó•ÂøóÔºàÊºîÁ§∫Ôºâ`);
            // ËøôÈáåÂèØ‰ª•Ê∑ªÂä†ÂÆûÈôÖÁöÑÂΩíÊ°£ÈÄªËæë
            selectedIds = [];
            renderTable();
        }
    }
}
function toggleDeleteDropdown() {
    const dropdown = document.getElementById('deleteDropdown');
    dropdown.classList.toggle('show');
}

function deleteSelected() {
    if (selectedIds.length > 0) {
        if (confirm(`Á°ÆÂÆöË¶ÅÂà†Èô§ÈÄâ‰∏≠ÁöÑ ${selectedIds.length} Êù°Â§±Ë¥•Êó•ÂøóÂêóÔºüÂà†Èô§ÂêéÂ∞ÜÊó†Ê≥ïÊÅ¢Â§ç„ÄÇ`)) {
            alert(`Â∑≤Âà†Èô§ÈÄâ‰∏≠ÁöÑ ${selectedIds.length} Êù°Â§±Ë¥•Êó•ÂøóÔºàÊºîÁ§∫Ôºâ`);
            // ËøôÈáåÂèØ‰ª•Ê∑ªÂä†ÂÆûÈôÖÁöÑÂà†Èô§ÈÄªËæë
            selectedIds = [];
            renderTable();
        }
    }
    closeDeleteDropdown();
}

function deleteAll() {
    const failLogs = filterLogs(allFailLogs[currentType]||[]);
    if (failLogs.length > 0) {
        if (confirm(`Á°ÆÂÆöË¶ÅÂà†Èô§ÂΩìÂâç‰∏ªÊï∞ÊçÆÁ±ªÂûãÁöÑÂÖ®ÈÉ® ${failLogs.length} Êù°Â§±Ë¥•Êó•ÂøóÂêóÔºüÂà†Èô§ÂêéÂ∞ÜÊó†Ê≥ïÊÅ¢Â§ç„ÄÇ`)) {
            alert(`Â∑≤Âà†Èô§ÂÖ®ÈÉ® ${failLogs.length} Êù°Â§±Ë¥•Êó•ÂøóÔºàÊºîÁ§∫Ôºâ`);
            // ËøôÈáåÂèØ‰ª•Ê∑ªÂä†ÂÆûÈôÖÁöÑÂà†Èô§ÈÄªËæë
            selectedIds = [];
            renderTable();
        }
    }
    closeDeleteDropdown();
}

function closeDeleteDropdown() {
    const dropdown = document.getElementById('deleteDropdown');
    dropdown.classList.remove('show');
}

// ÁÇπÂáªÂ§ñÈÉ®ÂÖ≥Èó≠‰∏ãÊãâËèúÂçï
document.addEventListener('click', function(event) {
    const dropdowns = document.querySelectorAll('.dropdown');
    
    dropdowns.forEach(dropdown => {
        if (!dropdown.contains(event.target)) {
            const content = dropdown.querySelector('.dropdown-content');
            if (content) {
                content.classList.remove('show');
            }
        }
    });
});
// Â∑¶‰æß‰∏ªÊï∞ÊçÆÁ±ªÂûãÂàáÊç¢
function bindTypeList() {
    document.querySelectorAll('.data-type-item').forEach(item => {
        item.onclick = function() {
            document.querySelectorAll('.data-type-item').forEach(i => i.classList.remove('active'));
            this.classList.add('active');
            currentType = this.querySelector('.data-type-info span:last-child').textContent;
            renderTable();
        };
    });
    document.getElementById('dataTypeSearch').addEventListener('input', function(e) {
        const searchTerm = e.target.value.toLowerCase();
        document.querySelectorAll('.data-type-item').forEach(item => {
            const text = item.querySelector('.data-type-info span:last-child').textContent.toLowerCase();
            item.style.display = text.includes(searchTerm) ? 'flex' : 'none';
        });
    });
}
// ÂàùÂßãÂåñ
renderQuerySection();
renderToolbar();
renderTable();
bindTypeList();

function viewMessage(id) {
    const logs = currentTab === 'sync' ? allSyncLogs[currentType] : allFailLogs[currentType];
    const log = logs.find(l => l.id === id);
    if (!log) return;
    
    document.getElementById('drawerTitle').textContent = `Êä•ÊñáËØ¶ÊÉÖ - ${log.code}`;
    document.getElementById('drawerRequest').textContent = JSON.stringify({
        dataType: log.req.dataType,
        operation: log.req.op,
        timestamp: '2024-06-01T10:30:00Z',
        requestId: 'REQ_' + Math.random().toString(36).substr(2, 9),
        data: {
            example: 'Êé•Êî∂Âà∞ÁöÑÊï∞ÊçÆÂÜÖÂÆπ',
            format: 'JSON/XML',
            size: '2.5KB'
        }
    }, null, 2);
    
    document.getElementById('drawerResponse').textContent = JSON.stringify({
        code: log.resp.code,
        message: log.resp.msg,
        timestamp: '2024-06-01T10:30:01Z',
        responseId: 'RESP_' + Math.random().toString(36).substr(2, 9),
        data: {
            result: log.result === 'ÊàêÂäü' ? 'SUCCESS' : 'FAILED',
            processedRecords: log.result === 'ÊàêÂäü' ? 1 : 0,
            errorDetails: log.result === 'Â§±Ë¥•' ? log.info : null
        }
    }, null, 2);
    
    document.getElementById('drawerMask').style.display = 'block';
}
</script>
</body>
</html> 