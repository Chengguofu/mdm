<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>æ•°æ®æ¨é€é…ç½®</title>
    <link href="https://cdn.bootcdn.net/ajax/libs/twitter-bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body, table, th, td, .form-control, .form-select, .btn, .btn-sm {
            font-size: 13px !important;
        }
        body {
            background-color: #f4f7fa;
            padding: 2rem;
        }
        .nav-tabs .nav-link {
            border-top-left-radius: .5rem;
            border-top-right-radius: .5rem;
            font-weight: 500;
        }
        .tab-content {
            border: 1px solid #dee2e6;
            border-top: 0;
            padding: 1.5rem;
            background-color: #fff;
            border-bottom-left-radius: .5rem;
            border-bottom-right-radius: .5rem;
        }
        .config-table-in-tab td {
            padding: 0.8rem 1rem;
            vertical-align: middle;
        }
        .config-table-in-tab td:first-child {
            width: 25%;
            font-weight: 500;
            background-color: #f8f9fa;
        }
        .form-label {
            margin-bottom: 0.2rem;
            font-weight: 500;
        }
        .desc-text {
            color: #888;
            font-size: 0.95em;
        }
        .expr-input-custom {
            width: 100%;
            min-width: 0;
            border-radius: 8px !important;
            border: 1.2px solid #c0d3eb !important;
            background: #f9fbfd !important;
            box-shadow: none !important;
            padding: 6px 10px !important;
            font-size: 13px !important;
            transition: border 0.2s, box-shadow 0.2s;
            padding-right: 30px !important;
        }
        .expr-input-custom:focus {
            border-color: #2176c7 !important;
            box-shadow: 0 0 0 2px #e3f0fc !important;
            background: #fff !important;
        }
        .expr-query-btn {
            position: absolute;
            right: 6px;
            top: 50%;
            transform: translateY(-50%);
            cursor: pointer;
            font-size: 16px;
            color: #2176c7;
            transition: color 0.18s;
            z-index: 2;
        }
        .expr-query-btn:hover {
            color: #185a99;
        }
        .page-title, h3.mb-4 {
            font-size: 20px !important;
        }
        .expr-input-wrap {
            position: relative;
            display: block;
            width: 100%;
        }
        .container-fluid, .tab-content, .tab-pane, .config-table-in-tab, .config-table-in-tab *, .form-control, .form-select, .btn, .btn-sm {
            font-size: 14px !important;
        }
    </style>
</head>
<body>
<div class="container-fluid">
    <h3 class="mb-4 page-title">æ•°æ®æ¨é€æ¥å£é…ç½®</h3>
    <ul class="nav nav-tabs" id="pushConfigTab" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" id="basic-config-tab" data-bs-toggle="tab" data-bs-target="#basic-config" type="button" role="tab" aria-controls="basic-config" aria-selected="true">åŸºæœ¬é…ç½®</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="exception-handling-tab" data-bs-toggle="tab" data-bs-target="#exception-handling" type="button" role="tab" aria-controls="exception-handling" aria-selected="false">å¼‚å¸¸å¤„ç†</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="verify-config-tab" data-bs-toggle="tab" data-bs-target="#verify-config" type="button" role="tab" aria-controls="verify-config" aria-selected="false">éªŒè¯é…ç½®</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="field-config-tab" data-bs-toggle="tab" data-bs-target="#field-config" type="button" role="tab" aria-controls="field-config" aria-selected="false">å‘é€æ¥å£å­—æ®µ</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="send-condition-tab" data-bs-toggle="tab" data-bs-target="#send-condition" type="button" role="tab" aria-controls="send-condition" aria-selected="false">å‘é€æ¡ä»¶</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="format-preview-tab" data-bs-toggle="tab" data-bs-target="#format-preview" type="button" role="tab" aria-controls="format-preview" aria-selected="false">æ•°æ®æ ¼å¼é¢„è§ˆ</button>
        </li>
    </ul>
    <div class="tab-content" id="pushConfigTabContent">
        <!-- åŸºæœ¬é…ç½® Tab -->
        <div class="tab-pane fade show active" id="basic-config" role="tabpanel" aria-labelledby="basic-config-tab">
            <table class="table table-bordered m-0 config-table-in-tab">
                <tbody>
                    <tr>
                        <td style="width:18%;">ä¸šåŠ¡ç³»ç»Ÿï¼ˆç³»ç»Ÿæ ‡è¯†ï¼‰</td>
                        <td style="width:32%;"><select class="form-select form-control-sm" style="width:90%;display:inline-block;"><option>OAç³»ç»Ÿ</option><option>ERPç³»ç»Ÿ</option><option>CRMç³»ç»Ÿ</option></select></td>
                        <td style="width:18%;">æ¥å£ç¼–ç </td>
                        <td style="width:32%;"><input type="text" class="form-control form-control-sm" style="width:90%;display:inline-block;"></td>
                    </tr>
                    <tr>
                        <td>æ¥å£åç§°</td>
                        <td><input type="text" class="form-control form-control-sm" style="width:90%;display:inline-block;"></td>
                        <td>æ¥å£åœ°å€</td>
                        <td><input type="text" class="form-control form-control-sm" style="width:90%;display:inline-block;"></td>
                    </tr>
                    <tr>
                        <td>æ¥å£æœåŠ¡IP</td>
                        <td><input type="text" class="form-control form-control-sm" style="width:90%;display:inline-block;" placeholder="å¦‚ 192.168.1.100"></td>
                        <td>æœåŠ¡ç«¯å£</td>
                        <td><input type="text" class="form-control form-control-sm" style="width:90%;display:inline-block;" placeholder="å¦‚ 8080"></td>
                    </tr>
                    <tr>
                        <td>æ¥å£ç±»å‹</td>
                        <td colspan="1">
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" name="apiType" id="json" checked>
                                <label class="form-check-label" for="json">JSON</label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" name="apiType" id="xml">
                                <label class="form-check-label" for="xml">XML</label>
                            </div>
                        </td>
                        <td>æœåŠ¡æ–¹å¼</td>
                        <td>
                            <select class="form-select form-control-sm" style="width:90%;display:inline-block;">
                                <option>æ‰‹åŠ¨åŒæ­¥</option>
                                <option>å®šæ—¶åŒæ­¥</option>
                                <option>å®æ—¶åŒæ­¥</option>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td>åŒæ­¥æ–¹å¼</td>
                        <td colspan="1">
                             <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" name="syncMode" id="sync" checked>
                                <label class="form-check-label" for="sync">åŒæ­¥</label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" name="syncMode" id="async">
                                <label class="form-check-label" for="async">å¼‚æ­¥</label>
                            </div>
                        </td>
                        <td>HTTPå‘é€æ–¹å¼</td>
                        <td>
                            <select class="form-select form-control-sm" style="width:90%;display:inline-block;">
                                <option>POST</option>
                                <option>PUT</option>
                                <option>PATCH</option>
                                <option>GET</option>
                                <option>DELETE</option>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td>å®šæ—¶æ–¹å¼</td>
                        <td colspan="3">
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" name="scheduleType" id="scheduleTypeNormal" value="normal" checked>
                                <label class="form-check-label" for="scheduleTypeNormal">å®šæ—¶é…ç½®</label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" name="scheduleType" id="scheduleTypeCron" value="cron">
                                <label class="form-check-label" for="scheduleTypeCron">Cronè¡¨è¾¾å¼</label>
                            </div>
                        </td>
                    </tr>
                    <tr id="normalScheduleRow">
                        <td>å®šæ—¶é…ç½®</td>
                        <td colspan="3">
                            <div class="row g-2 mb-2" style="display:flex;align-items:center;gap:10px;">
                                <div style="flex:1;min-width:120px;">
                                    <label class="form-label">å¼€å§‹æ‰§è¡Œæ—¶é—´</label>
                                    <input type="time" class="form-control form-control-sm">
                                </div>
                                <div style="flex:1;min-width:120px;">
                                    <label class="form-label">æ‰§è¡Œæ—¶é—´é—´éš”</label>
                                    <input type="text" class="form-control form-control-sm" placeholder="åˆ†é’Ÿ/å°æ—¶/å¤©">
                                </div>
                            </div>
                        </td>
                    </tr>
                    <tr id="cronScheduleRow" style="display:none;">
                        <td>Cronè¡¨è¾¾å¼</td>
                        <td colspan="3">
                            <input type="text" class="form-control form-control-sm" placeholder="å¦‚ 0 0 * * *ï¼Œå¯ç›´æ¥å½•å…¥cronè¡¨è¾¾å¼">
                            <div class="desc-text">å¯é€‰ï¼šç›´æ¥å¡«å†™cronè¡¨è¾¾å¼ï¼ˆå¦‚ 0 0 * * * è¡¨ç¤ºæ¯å¤©0ç‚¹ï¼‰ï¼Œå¡«å†™åä¼˜å…ˆä½¿ç”¨æ­¤è¡¨è¾¾å¼è¿›è¡Œå®šæ—¶ã€‚</div>
                        </td>
                    </tr>
                    <tr>
                        <td>å•æ¬¡åˆ†å‘è®°å½•æ•°</td>
                        <td colspan="3">
                            <input type="number" class="form-control form-control-sm" placeholder="è¯·è¾“å…¥å•æ¬¡åˆ†å‘è®°å½•æ•°">
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        <!-- å¼‚å¸¸å¤„ç† Tab -->
        <div class="tab-pane fade" id="exception-handling" role="tabpanel" aria-labelledby="exception-handling-tab">
            <table class="table table-bordered m-0 config-table-in-tab">
                <tbody>
                    <tr>
                        <td>æ¶ˆæ¯æé†’</td>
                        <td><input type="text" class="form-control" placeholder="ç”¨æˆ·"></td>
                    </tr>
                    <tr>
                        <td>é‚®ä»¶æé†’</td>
                        <td><input type="text" class="form-control" placeholder="ç”¨æˆ·"></td>
                    </tr>
                    <tr>
                        <td>å¤±è´¥æ˜¯å¦è‡ªåŠ¨é‡å‘</td>
                        <td>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" name="retry" id="retry-yes" value="yes" checked>
                                <label class="form-check-label" for="retry-yes">æ˜¯</label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" name="retry" id="retry-no" value="no">
                                <label class="form-check-label" for="retry-no">å¦</label>
                            </div>
                            <div id="retryExtraWrap" style="margin-top:8px;display:none;">
                                <div style="display:flex;gap:16px;align-items:center;">
                                    <input id="retryCountInput" type="number" class="form-control" style="max-width:180px;" placeholder="é‡å‘å¤±è´¥æ•°æ®æ¬¡æ•°">
                                    <input id="retryIntervalInput" type="number" class="form-control" style="max-width:220px;" placeholder="é‡å‘æ—¶é—´é—´éš”ï¼ˆç§’ï¼‰">
                                </div>
                                <div class="desc-text">è®¾ç½®é‡å‘æ¬¡æ•°å’Œæ¯æ¬¡é‡å‘ä¹‹é—´çš„é—´éš”æ—¶é—´ï¼ˆå•ä½ï¼šç§’ï¼‰</div>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        <!-- éªŒè¯é…ç½® Tab -->
        <div class="tab-pane fade" id="verify-config" role="tabpanel" aria-labelledby="verify-config-tab">
            <table class="table table-bordered m-0 config-table-in-tab" style="table-layout:fixed;">
                <tbody>
                    <tr>
                        <td style="width:12%;min-width:80px;">å¤´ä¿¡æ¯é…ç½®</td>
                        <td>
                            <table class="table table-bordered table-sm mb-2" style="min-width:400px;">
                                <thead class="table-light">
                                    <tr><th style="width:28%">å‚æ•°å</th><th style="width:36%">å‚æ•°å€¼</th><th style="width:16%">æ“ä½œ</th></tr>
                                </thead>
                                <tbody id="headerParams"></tbody>
                                <tfoot></tfoot>
                            </table>
                        </td>
                    </tr>
                    <tr>
                        <td style="width:12%;min-width:80px;">è·å–TOKEN</td>
                        <td>
                            <div style="margin-bottom:12px;display:flex;align-items:center;gap:12px;">
                                <label style="font-weight:500;min-width:120px;">Tokenè·å–æ¥å£åœ°å€</label>
                                <input type="text" class="form-control form-control-sm" style="flex:1;min-width:180px;max-width:546px;" placeholder="è¯·è¾“å…¥Tokenè·å–æ¥å£åœ°å€">
                            </div>
                            <table class="table table-bordered table-sm mb-2" style="min-width:400px;">
                                <thead class="table-light">
                                    <tr><th style="width:28%">å‚æ•°å</th><th style="width:36%">å‚æ•°å€¼</th><th style="width:16%">æ“ä½œ</th></tr>
                                </thead>
                                <tbody id="tokenParams"></tbody>
                                <tfoot></tfoot>
                            </table>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        <!-- å‘é€æ¥å£å­—æ®µ Tab -->
        <div class="tab-pane fade" id="field-config" role="tabpanel" aria-labelledby="field-config-tab">
            <table class="table table-bordered m-0 config-table-in-tab">
                <tbody>
                    <tr>
                        <td>å‘é€æ¥å£å­—æ®µé…ç½®</td>
                        <td>
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="allFieldsSelectable" checked>
                                <label class="form-check-label" for="allFieldsSelectable">åŒ…å«å­è¡¨</label>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td colspan="2" class="p-0">
                            <table class="table table-hover table-sm mb-0">
                                <thead class="table-light">
                                    <tr>
                                        <th style="width:8.8%;">å­—æ®µå</th>
                                        <th>ä¸­æ–‡å</th>
                                        <th>ç±»å‹</th>
                                        <th style="width:12%;">å¼•ç”¨å±æ€§</th>
                                        <th>æ˜¯å¦é€‰æ‹©</th>
                                        <th>å­—æ®µæ˜ å°„åç§°</th>
                                        <th>è½¬æ¢è¡¨è¾¾å¼</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>CUST_ID</td>
                                        <td>å®¢æˆ·ç¼–ç </td>
                                        <td>String</td>
                                        <td><select class="form-select form-select-sm" disabled><option value="">æ— </option></select></td>
                                        <td><input type="checkbox" class="form-check-input" checked></td>
                                        <td><input type="text" class="form-control form-control-sm" value="customerId"></td>
                                        <td>
                                            <div class="expr-input-wrap" style="position:relative;display:block;">
                                                <input type="text" class="form-control form-control-sm" placeholder="è¯·è¾“å…¥è½¬æ¢è¡¨è¾¾å¼" style="width:100%;padding-right:30px;">
                                                <span class="expr-query-btn" style="position:absolute;right:8px;top:50%;transform:translateY(-50%);cursor:pointer;font-size:16px;color:#2176c7;z-index:2;" title="è¡¨è¾¾å¼ç¼–è¾‘" onclick="window.open('expression.html','_blank','width=700,height=500')">ğŸ”</span>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>CUST_NAME</td>
                                        <td>å®¢æˆ·åç§°</td>
                                        <td>String</td>
                                        <td><select class="form-select form-select-sm" disabled><option value="">æ— </option></select></td>
                                        <td><input type="checkbox" class="form-check-input" checked></td>
                                        <td><input type="text" class="form-control form-control-sm" value="customerName"></td>
                                        <td>
                                            <div class="expr-input-wrap" style="position:relative;display:block;">
                                                <input type="text" class="form-control form-control-sm" placeholder="è¯·è¾“å…¥è½¬æ¢è¡¨è¾¾å¼" style="width:100%;padding-right:30px;">
                                                <span class="expr-query-btn" style="position:absolute;right:8px;top:50%;transform:translateY(-50%);cursor:pointer;font-size:16px;color:#2176c7;z-index:2;" title="è¡¨è¾¾å¼ç¼–è¾‘" onclick="window.open('expression.html','_blank','width=700,height=500')">ğŸ”</span>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>ADDRESS</td>
                                        <td>åœ°å€</td>
                                        <td>String</td>
                                        <td><select class="form-select form-select-sm" disabled><option value="">æ— </option></select></td>
                                        <td><input type="checkbox" class="form-check-input" checked></td>
                                        <td><input type="text" class="form-control form-control-sm" value="address"></td>
                                        <td>
                                            <div class="expr-input-wrap" style="position:relative;display:block;">
                                                <input type="text" class="form-control form-control-sm" placeholder="è¯·è¾“å…¥è½¬æ¢è¡¨è¾¾å¼" style="width:100%;padding-right:30px;">
                                                <span class="expr-query-btn" style="position:absolute;right:8px;top:50%;transform:translateY(-50%);cursor:pointer;font-size:16px;color:#2176c7;z-index:2;" title="è¡¨è¾¾å¼ç¼–è¾‘" onclick="window.open('expression.html','_blank','width=700,height=500')">ğŸ”</span>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>CONTACT</td>
                                        <td>è”ç³»äºº</td>
                                        <td>String</td>
                                        <td><select class="form-select form-select-sm">
                                            <option value="">æ— </option>
                                            <option>å®¢æˆ·ä¸»æ•°æ®.è”ç³»äººç”µè¯</option>
                                            <option>å®¢æˆ·ä¸»æ•°æ®.è”ç³»äººé‚®ç®±</option>
                                        </select></td>
                                        <td><input type="checkbox" class="form-check-input"></td>
                                        <td><input type="text" class="form-control form-control-sm" value="contact"></td>
                                        <td>
                                            <div class="expr-input-wrap" style="position:relative;display:block;">
                                                <input type="text" class="form-control form-control-sm" placeholder="è¯·è¾“å…¥è½¬æ¢è¡¨è¾¾å¼" style="width:100%;padding-right:30px;">
                                                <span class="expr-query-btn" style="position:absolute;right:8px;top:50%;transform:translateY(-50%);cursor:pointer;font-size:16px;color:#2176c7;z-index:2;" title="è¡¨è¾¾å¼ç¼–è¾‘" onclick="window.open('expression.html','_blank','width=700,height=500')">ğŸ”</span>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        <!-- å‘é€æ¡ä»¶ Tab -->
        <div class="tab-pane fade" id="send-condition" role="tabpanel" aria-labelledby="send-condition-tab">
            <iframe src="condition.html" style="width:100%;min-height:600px;border:none;border-radius:8px;"></iframe>
        </div>
        <!-- æ•°æ®æ ¼å¼é¢„è§ˆ Tab -->
        <div class="tab-pane fade" id="format-preview" role="tabpanel" aria-labelledby="format-preview-tab">
            <table class="table table-bordered m-0 config-table-in-tab">
                <tbody>
                    <tr>
                        <td>å‘é€æ•°æ®æ ¼å¼</td>
                        <td>
<pre class="bg-light p-3 rounded"><code>{
  "CUST_ID": "C001",
  "CUST_NAME": "ç¤ºä¾‹å®¢æˆ·",
  "ADDRESS": "ç¤ºä¾‹åœ°å€",
  "ITEMS": [
    {
      "ITEM_ID": "I001",
      "ITEM_NAME": "å­è¡¨é¡¹1",
      "QTY": 10
    },
    {
      "ITEM_ID": "I002",
      "ITEM_NAME": "å­è¡¨é¡¹2",
      "QTY": 5
    }
  ]
}</code></pre>
                        </td>
                    </tr>
                    <tr>
                        <td>è¿”å›æ•°æ®æ ¼å¼</td>
                        <td>
<pre class="bg-light p-3 rounded"><code>{
  "success": true,
  "message": "å¤„ç†æˆåŠŸ"
}</code></pre>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
    <div style="position:fixed;left:0;right:0;bottom:0;z-index:9999;background:#fff;border-top:1px solid #e9ecef;padding:8px 24px;display:flex;justify-content:flex-end;gap:16px;">
        <button class="btn btn-primary btn-sm">ä¿å­˜</button>
        <button class="btn btn-success btn-sm">å¯ç”¨</button>
    </div>
</div>
<div class="modal fade" id="exprEditorModal" tabindex="-1">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">è¡¨è¾¾å¼ç¼–è¾‘å™¨</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <div class="expr-tools" id="exprTools">
          <select id="fieldSelectExpr"></select>
          <select id="opSelectExpr">
            <option value="">æ“ä½œç¬¦</option>
            <option value="+">+</option>
            <option value="-">-</option>
            <option value="*">*</option>
            <option value="/">/</option>
            <option value="||">å­—ç¬¦æ‹¼æ¥ï¼ˆ||ï¼‰</option>
            <option value="=">=</option>
            <option value="!=">!=</option>
            <option value=">">&gt;</option>
            <option value="<">&lt;</option>
            <option value=">=">&gt;=</option>
            <option value="<=">&lt;=</option>
            <option value="AND">AND</option>
            <option value="OR">OR</option>
            <option value="(">ï¼ˆ</option>
            <option value=")">ï¼‰</option>
          </select>
          <select id="funcSelectExpr">
            <option value="">å¸¸ç”¨å‡½æ•°</option>
            <option value="LEN">LEN(å­—æ®µ)</option>
            <option value="ISNULL">ISNULL(å­—æ®µ,é»˜è®¤å€¼)</option>
            <option value="SUBSTR">SUBSTR(å­—æ®µ,èµ·å§‹,é•¿åº¦)</option>
            <option value="TRIM">TRIM(å­—æ®µ)</option>
            <option value="UPPER">UPPER(å­—æ®µ)</option>
            <option value="LOWER">LOWER(å­—æ®µ)</option>
            <option value="REPLACE">REPLACE(å­—æ®µ,åŸ,æ–°)</option>
            <option value="CONCAT">CONCAT(å­—æ®µ1,å­—æ®µ2,...)</option>
            <option value="IF">IF(æ¡ä»¶,å€¼1,å€¼2)</option>
            <option value="TODATE">TODATE(å­—ç¬¦ä¸²,æ ¼å¼)</option>
            <option value="FORMATDATE">FORMATDATE(æ—¥æœŸ,æ ¼å¼)</option>
            <option value="YEAR">YEAR(æ—¥æœŸ)</option>
            <option value="MONTH">MONTH(æ—¥æœŸ)</option>
            <option value="DAY">DAY(æ—¥æœŸ)</option>
          </select>
          <input id="constInputExpr" placeholder="å¸¸é‡/å€¼" style="width:120px;">
        </div>
        <div class="form-row">
          <div class="form-label">è¡¨è¾¾å¼</div>
          <div class="form-value">
            <textarea id="exprInputExpr" class="form-control" style="min-height:80px;"></textarea>
          </div>
        </div>
        <div class="form-row">
          <div class="form-label">å®æ—¶é¢„è§ˆ</div>
          <div class="form-value">
            <div id="exprPreview" style="background:#f8f9fa;padding:8px 12px;border-radius:6px;color:#2176c7;"></div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-primary" id="exprOkBtn">ç¡®å®š</button>
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">å–æ¶ˆ</button>
      </div>
    </div>
  </div>
</div>
<script src="https://cdn.bootcdn.net/ajax/libs/twitter-bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.bootcdn.net/ajax/libs/awesomplete/1.1.5/awesomplete.min.js"></script>
<link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/awesomplete/1.1.5/awesomplete.min.css" />
<script>
// å¤±è´¥æ˜¯å¦è‡ªåŠ¨é‡å‘è”åŠ¨
document.addEventListener('DOMContentLoaded', function() {
  function toggleRetryCountInput() {
    var yes = document.getElementById('retry-yes');
    var input = document.getElementById('retryCountInput');
    var intervalWrap = document.getElementById('retryIntervalWrap');
    if (yes && input && intervalWrap) {
      input.style.display = yes.checked ? '' : 'none';
      intervalWrap.style.display = yes.checked ? '' : 'none';
    }
  }
  var yes = document.getElementById('retry-yes');
  var no = document.getElementById('retry-no');
  if (yes && no) {
    yes.addEventListener('change', toggleRetryCountInput);
    no.addEventListener('change', toggleRetryCountInput);
    toggleRetryCountInput();
  }
});

function addParamRow(containerId) {
  var container = document.getElementById(containerId);
  var tr = document.createElement('tr');
  tr.innerHTML = `
    <td><input type="text" class="form-control form-control-sm" placeholder="å‚æ•°å" style="width:70%;min-width:60px;"></td>
    <td><input type="text" class="form-control form-control-sm" placeholder="å‚æ•°å€¼" style="width:70%;min-width:60px;"></td>
    <td class="text-center">
      <button type="button" class="btn btn-link btn-sm" onclick="addParamRow('${containerId}')">ï¼‹ æ–°å¢ä¸€è¡Œ</button>
      <button type="button" style="background:none;border:none;color:#e74c3c;font-size:15px;padding:0 8px;" onclick="this.closest('tr').remove()">åˆ é™¤</button>
    </td>
  `;
  container.appendChild(tr);
}

// åˆå§‹åŒ–å„åŠ ä¸€è¡Œ
document.addEventListener('DOMContentLoaded', function() {
  addParamRow('headerParams');
  addParamRow('tokenParams');
});

// è‡ªåŠ¨è¡¥å…¨å†…å®¹
const exprFields = ['CUST_ID','CUST_NAME','ADDRESS','CONTACT'];
const exprFuncs = ['UPPER()','LOWER()','LEN()','ISNULL(,)','SUBSTR(,,)','TRIM()','REPLACE(,,)','CONCAT(,)','IF(,,)','TODATE(,yyyy-MM-dd)','FORMATDATE(,yyyy-MM-dd)','YEAR()','MONTH()','DAY()'];
const exprOps = ['+','-','*','/','||','=','!=','>','<','>=','<=','AND','OR','ï¼ˆ','ï¼‰'];
const exprList = exprFields.concat(exprFuncs).concat(exprOps);
document.querySelectorAll('.expr-input-autocomplete').forEach(function(input){
  new Awesomplete(input, { list: exprList, minChars: 1, maxItems: 10 });
});

// å­—æ®µæ˜ å°„åç§°å’Œè½¬æ¢è¡¨è¾¾å¼è¾“å…¥æ¡†å¯ç¼–è¾‘æ€§è”åŠ¨
function updateFieldRowEditable() {
  document.querySelectorAll('#field-config table.table-hover tbody tr').forEach(function(tr) {
    var checkbox = tr.querySelector('td:nth-child(5) input[type="checkbox"]');
    var mappingInput = tr.querySelector('td:nth-child(6) input');
    var exprInput = tr.querySelector('td:nth-child(7) input');
    if (checkbox && mappingInput && exprInput) {
      if (!checkbox.checked) {
        mappingInput.disabled = true;
        exprInput.disabled = true;
        mappingInput.style.background = '#f1f1f1';
        exprInput.style.background = '#f1f1f1';
        mappingInput.style.color = '#aaa';
        exprInput.style.color = '#aaa';
      } else {
        mappingInput.disabled = false;
        exprInput.disabled = false;
        mappingInput.style.background = '';
        exprInput.style.background = '';
        mappingInput.style.color = '';
        exprInput.style.color = '';
      }
    }
  });
}
document.addEventListener('DOMContentLoaded', function() {
  // åˆå§‹åŒ–
  updateFieldRowEditable();
  // ç›‘å¬checkboxå˜åŒ–
  document.querySelectorAll('#field-config table.table-hover tbody tr').forEach(function(tr) {
    var checkbox = tr.querySelector('td:nth-child(5) input[type="checkbox"]');
    if (checkbox) {
      checkbox.addEventListener('change', updateFieldRowEditable);
    }
  });
});

document.addEventListener('DOMContentLoaded', function() {
  function toggleScheduleType() {
    var normalRow = document.getElementById('normalScheduleRow');
    var cronRow = document.getElementById('cronScheduleRow');
    var type = document.querySelector('input[name="scheduleType"]:checked').value;
    if (type === 'normal') {
      normalRow.style.display = '';
      cronRow.style.display = 'none';
    } else {
      normalRow.style.display = 'none';
      cronRow.style.display = '';
    }
  }
  document.getElementById('scheduleTypeNormal').addEventListener('change', toggleScheduleType);
  document.getElementById('scheduleTypeCron').addEventListener('change', toggleScheduleType);
  toggleScheduleType();
});

document.addEventListener('DOMContentLoaded', function() {
  function toggleRetryExtraInput() {
    var yes = document.getElementById('retry-yes');
    var extraWrap = document.getElementById('retryExtraWrap');
    if (yes && extraWrap) {
      extraWrap.style.display = yes.checked ? '' : 'none';
    }
  }
  var yes = document.getElementById('retry-yes');
  var no = document.getElementById('retry-no');
  if (yes && no) {
    yes.addEventListener('change', toggleRetryExtraInput);
    no.addEventListener('change', toggleRetryExtraInput);
    // é¡µé¢åŠ è½½æ—¶ç«‹å³æ‰§è¡Œä¸€æ¬¡ï¼Œç¡®ä¿åˆå§‹çŠ¶æ€æ­£ç¡®
    toggleRetryExtraInput();
  }
});
</script>
</body>
</html> 